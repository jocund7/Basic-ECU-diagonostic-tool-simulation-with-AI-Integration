<!DOCTYPE html>
<html>
<head>
    <title>UDS Diagnostic Tool</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .panel { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        h2 { margin-top: 0; color: #333; }
        input, button { padding: 8px; margin: 5px 0; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        .response { background-color: #f5f5f5; padding: 10px; border-radius: 3px; margin-top: 10px; }
        .hex-input { font-family: monospace; }
        
    </style>
</head>
<body>
    <h1>ECU Diagnostic Tool</h1>
    
    <div class="panel">
        <h2>Read Memory</h2>
        <div>
            Address: <input type="text" id="readAddr" class="hex-input" placeholder="e.g., 1000" value="1000">
            Length: <input type="text" id="readLen" placeholder="e.g., 10" value="10">
            <button onclick="readMemory()">Read</button>
        </div>
        <div id="readResponse" class="response"></div>
    </div>
    
    <div class="panel">
        <h2>Write Memory</h2>
        <div>
            Address: <input type="text" id="writeAddr" class="hex-input" placeholder="e.g., 1000" value="1000">
            Value: <input type="text" id="writeValue" class="hex-input" placeholder="e.g., AA BB CC" value="AA BB CC">
            <button onclick="writeMemory()">Write</button>
        </div>
        <div id="writeResponse" class="response"></div>
    </div>
    
    <div class="panel">
        <h2>Read Data by Identifier</h2>
        <div>
            Data ID: <input type="text" id="dataId" class="hex-input" placeholder="e.g., F100" value="F100">
            <button onclick="readDataId()">Read</button>
        </div>
        <div id="dataIdResponse" class="response"></div>
    </div>
    
    <div class="panel">
        <h2>ECU Control</h2>
        <button onclick="ecuReset()">Reset ECU</button>
        <div id="resetResponse" class="response"></div>
    </div>
    
    <script>
        // function readMemory() {
        //     const addr = document.getElementById('readAddr').value;
        //     const len = document.getElementById('readLen').value;
            
        //     fetch('/api/read_memory', {
        //         method: 'POST',
        //         headers: { 'Content-Type': 'application/json' },
        //         body: JSON.stringify({ address: addr, length: len })
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         document.getElementById('readResponse').innerText = data.response || 'No response';
        //     });
        // }
        function displayResponse(elementId, data) {
            const container = document.getElementById(elementId);
            if (data.error) {
                container.innerHTML = `<div class="error">ERROR: ${data.error}</div>`;
            } else {
                container.innerHTML = `
                    <div>Raw: ${data.response || 'None'}</div>
                    <div>${data.message}</div>
                `;
            }
        }
        
        // Update all your API call handlers like this:
        function readMemory() {
            const addr = document.getElementById('readAddr').value;
            const len = document.getElementById('readLen').value;
            
            fetch('/api/read_memory', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ address: addr, length: len })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    displayResponse('readResponse', data);
                } else {
                    displayResponse('readResponse', data);
                }
            });
        }
        
        function writeMemory() {
            const addr = document.getElementById('writeAddr').value;
            const value = document.getElementById('writeValue').value;
            
            fetch('/api/write_memory', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ address: addr, value: value })
            })
            .then(response => response.json())
            // .then(data => {
            //     document.getElementById('writeResponse').innerText = data.response || 'No response';
            // });
            .then(data => {
                if (data.error) {
                    displayResponse('writeResponse', data);
                } else {
                    displayResponse('writeResponse', data);
                }
            });
        }
        
        // function readDataId() {
        //     const dataId = document.getElementById('dataId').value;
            
        //     fetch('/api/read_data_id', {
        //         method: 'POST',
        //         headers: { 'Content-Type': 'application/json' },
        //         body: JSON.stringify({ data_id: dataId })
        //     })
        //     .then(response => response.json())
        //     // .then(data => {
        //     //     document.getElementById('dataIdResponse').innerText = data.response || 'No response';
        //     // });
        //     .then(data => {
        //         if (data.error) {
        //             displayResponse('dataIdResponse', data);
        //         } else {
        //             displayResponse('dataIdResponse', data);
        //         }
        //     });
        // }
        function readDataId() {
    fetch('/api/read_data_id', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ data_id: 'F100' })
    })
    .then(response => response.json())
    .then(data => {
        console.log("Full API response:", data);  // Check if raw_response exists
        displayResponse('dataIdResponse', data);
    });
}
        
        function ecuReset() {
            fetch('/api/ecu_reset', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            // .then(data => {
            //     document.getElementById('resetResponse').innerText = data.response || 'No response';
            // });
            .then(data => {
                if (data.error) {
                    displayResponse('resetResponse', data);
                } else {
                    displayResponse('resetResponse', data);
                }
            });
        }
    </script>
</body>
</html>